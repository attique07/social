import{_ as x,B as L,S as C,Y as I,A as P,h as D,i as B,m as u,u as A,j,k as z,l as U,n as $,p as M,q as p,s as N,r as i,o,c as a,a as s,t as m,e as b,g as v,w as f,b as l,F as V,v as E,x as F}from"../../assets/app-73d10358.js";import{S as q}from"./StoryDetailModal-229f9f51.js";import"./StoryDetail-84b31e62.js";const H={components:{BaseIcon:L,StoryContentPreview:C,InfiniteLoading:I,Avatar:P,UserName:D,SlimScroll:B},props:["data","params","position"],data(){return{storiesList:[],currentPage:1}},computed:{...u(A,["user","authenticated"]),...u(j,["seenStoryItem","deleteStoryItem"]),...u(z,["samePage"]),...u(U,["setDynamicDialogShown"])},mounted(){this.getStoriesList(this.currentPage)},watch:{seenStoryItem(e){var t=window._.find(this.storiesList,{id:e.storyItem.story_id});t&&(!t.seen&&t.item.id!=e.storyItem.id&&(t.item=e.storyItem),!t.seen&&e.seen&&(t.seen=!0))},async deleteStoryItem(e){var t=window._.findIndex(this.storiesList,function(h){return h.id==e.storyId});if(t!=-1)try{var n=await $(e.storyId);this.storiesList[t]=n}catch{this.storiesList=this.storiesList.filter(d=>d.id!==e.storyId)}},samePage(){this.currentPage=1,this.storiesList=[],this.getStoriesList(this.currentPage)}},methods:{async getStoriesList(e){if(this.authenticated)try{let t=await M(e);return e==1&&(this.storiesList=[]),this.storiesList=window._.concat(this.storiesList,t),t}catch(t){this.showError(t.error)}},showStoryDetail(e){let t=this.$router.resolve({name:"story_view",params:{storyId:e}});p(t.fullPath),this.$dialog.open(q,{data:{id:e,storiesList:this.storiesList},props:{class:"p-dialog-story p-dialog-story-detail p-dialog-no-header-title",modal:!0,showHeader:!1,draggable:!1},onClose:()=>{p(this.$router.currentRoute.value.fullPath),N(),this.setDynamicDialogShown(!1)}}),this.setDynamicDialogShown(!0)},loadMoreStories(e){this.getStoriesList(++this.currentPage).then(t=>{t.length===0?e.complete():e.loaded()})},createStory(){if(this.user){let e="story.allow_create";this.checkPermission(e)&&this.$router.push({name:"stories"})}}}},R={key:0,class:"widget-box bg-white border border-white rounded-none md:rounded-base-lg p-4 mb-base-2 dark:bg-slate-800 dark:border-slate-800"},Y={key:0,class:"widget-box-header flex flex-wrap items-center justify-between gap-2 mb-5"},G={class:"text-main-color text-base-lg font-extrabold dark:text-white"},J={class:"create-story-box border border-divider rounded-base-lg relative pb-story-ratio bg-cover bg-center dark:bg-slate-800 dark:border-white/10"},K={class:"absolute left-0 top-0 right-0 bottom-16 border-b border-divider dark:border-slate-900"},O={class:"h-full"},Q=["src","alt"],T={class:"create-story-btn relative flex items-center justify-center bg-primary-color rounded-full -mt-5 w-10 h-10 mx-auto border-3 border-white z-10 dark:bg-dark-primary-color dark:border-slate-800"},W={class:"create-story-box-bottom absolute bottom-3 left-1 right-1 text-center font-semibold"},X=["onClick"],Z={class:"rounded-base-lg relative pb-story-ratio cursor-pointer text-sm overflow-hidden"},ee={class:"absolute left-3 top-2 z-10"},te={class:"create-story-box border border-divider rounded-base-lg relative pb-story-ratio bg-cover bg-center dark:bg-slate-800 dark:border-white/10"},se={class:"absolute left-0 top-0 right-0 bottom-16 border-b border-divider dark:border-slate-900"},re={class:"h-full"},oe=["src","alt"],ie={class:"create-story-btn relative flex items-center justify-center bg-primary-color rounded-full -mt-5 w-10 h-10 mx-auto border-3 border-white z-10 dark:bg-dark-primary-color dark:border-slate-800"},ae={class:"create-story-box-bottom absolute bottom-3 left-1 right-1 text-center font-semibold"};function le(e,t,n,h,d,c){const g=i("BaseIcon"),_=i("Avatar"),y=i("StoryContentPreview"),w=i("UserName"),S=i("InfiniteLoading"),k=i("SlimScroll");return e.authenticated?(o(),a("div",R,[n.data.enable_title?(o(),a("div",Y,[s("h3",G,m(n.data.title),1)])):b("",!0),d.storiesList.length>0?(o(),v(k,{key:1,gap:2},{default:f(()=>[s("div",{onClick:t[0]||(t[0]=r=>c.createStory()),class:"w-32 flex-32 cursor-pointer"},[s("div",J,[s("div",K,[s("div",O,[s("img",{class:"h-full rounded-t-base-lg object-cover",src:e.user.avatar,alt:e.user.user_name},null,8,Q)]),s("div",T,[l(g,{name:"plus",class:"text-white"})])]),s("div",W,m(e.$t("Create story")),1)])]),(o(!0),a(V,null,E(d.storiesList,r=>(o(),a("div",{class:"stories-list-scroll w-32 flex-32",key:r.id,onClick:ne=>c.showStoryDetail(r.id)},[s("div",Z,[s("div",ee,[l(_,{user:r.user,size:"2.4rem",border:!1,class:F(["border-3 rounded-full",r.seen?"border-white":"border-color-link dark:border-dark-primary-color"])},null,8,["user","class"])]),r.item?(o(),v(y,{key:0,story:r.item,class:"pointer-events-none"},null,8,["story"])):b("",!0),l(w,{user:r.user,router:!1,activePopover:!1,class:"stories-list-scroll-name absolute left-3 bottom-3 right-3 text-white"},null,8,["user"])])],8,X))),128)),l(S,{onInfinite:c.loadMoreStories},{spinner:f(()=>t[2]||(t[2]=[s("span",null,null,-1)])),complete:f(()=>t[3]||(t[3]=[s("span",null,null,-1)])),_:1},8,["onInfinite"])]),_:1})):(o(),a("div",{key:2,onClick:t[1]||(t[1]=r=>c.createStory()),class:"w-32 flex-32 cursor-pointer"},[s("div",te,[s("div",se,[s("div",re,[s("img",{class:"h-full rounded-t-base-lg object-cover",src:e.user.avatar,alt:e.user.user_name},null,8,oe)]),s("div",ie,[l(g,{name:"plus",class:"text-white"})])]),s("div",ae,m(e.$t("Create story")),1)])]))])):b("",!0)}const he=x(H,[["render",le]]);export{he as default};
