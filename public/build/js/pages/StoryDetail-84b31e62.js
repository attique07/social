import{O as S,B as I,al as p,am as x,m as d,C as k,an as _,q as c,ao as P,s as b,_ as N,l as B,j as f,u as D,r as y,o,c as l,a as w,F as L,v as M,e as h,E as C,b as u,g as V}from"../../assets/app-73d10358.js";const E={components:{Loading:S,BaseIcon:I,StoryItemDetail:p},props:{storyId:{default:""},storiesList:{default:[]},isPage:{default:!1}},data(){return{id:this.storyId,story:null,storyItem:null,showPrev:!1,showNext:!1,interval:null,time:0,run:!1}},watch:{storyItem(t){if(t){if(this.authenticated){x({id:t.id});var e=window._.findIndex(this.story.items,function(n){return n.id==t.id}),i=e==this.story.items.length-1;this.setSeenStoryItem({storyItem:i?this.story.items[0]:this.story.items[e+1],seen:i})}this.time=0,this.doPlayStory()}},time(t){parseInt(t)==this.config.storyTimeout&&(clearInterval(this.interval),this.interval=null,this.run=!1,this.showNext?this.nextStories():this.isPage||(this.$emit("closeModal"),this.storyItem=null))},deleteStoryItem(){this.story.items&&window._.find(this.story.items,{id:this.deleteStoryItem.id})&&(this.story.items=this.story.items.filter(t=>t.id!==this.deleteStoryItem.id),this.showPrev&&this.prevStories(),this.showNext&&this.nextStories()),this.storyItem&&this.storyItem.id==this.deleteStoryItem.id&&(this.$emit("closeModal"),this.storyItem=null)}},mounted(){this.id&&(this.loadStoryDetail(this.id),window.addEventListener("keydown",this.onKeyDown))},unmounted(){window.removeEventListener("keydown",this.onKeyDown)},computed:{...d(B,["config"]),...d(f,["deleteStoryItem"]),...d(D,["user","authenticated"])},methods:{...k(f,["setSeenStoryItem"]),async loadStoryDetail(t){try{this.story=await _(t);var e=this;this.storyItem=window._.find(this.story.items,function(i){return i.id==e.story.item_view_id}),this.checkShowButton()}catch(i){this.$emit("setError"),this.isPage||this.showError(i.error)}},prevStories(){var t=this,e=window._.findLast(this.story.items,function(s){return s.id<t.storyItem.id});if(e)this.storyItem=e,this.checkShowButton();else{var i=this.getIndexStory(),n=this.storiesList[i-1];this.id=n.id,this.loadStoryDetail(this.id);let s=this.$router.resolve({name:"story_view",params:{storyId:this.id}});c(s.fullPath)}},nextStories(){var t=this,e=window._.find(this.story.items,function(s){return s.id>t.storyItem.id});if(e)this.storyItem=e,this.checkShowButton();else{var i=this.getIndexStory(),n=this.storiesList[i+1];this.id=n.id,this.loadStoryDetail(this.id);let s=this.$router.resolve({name:"story_view",params:{storyId:this.id}});c(s.fullPath)}},checkShowButton(){var t=this,e=window._.findIndex(this.story.items,function(i){return i.id==t.storyItem.id});e==0&&this.story.items.length==1?(this.checkPrev(),this.checkNext()):e==0?(this.checkPrev(),this.showNext=!0):e==this.story.items.length-1?(this.checkNext(),this.showPrev=!0):(this.showPrev=!0,this.showNext=!0)},checkPrev(){var t=this.getIndexStory();t<1?this.showPrev=!1:this.showPrev=!0},checkNext(){var t=this.getIndexStory();this.storiesList.length>1&&t<this.storiesList.length-1?this.showNext=!0:this.showNext=!1},getIndexStory(){var t=this;return window._.findIndex(this.storiesList,function(e){return e.id==t.id})},doPlayStory(){parseInt(this.time)>=this.config.storyTimeout&&(this.time=0,this.storyItem=this.story.items[0],this.checkShowButton()),this.run=!0,this.interval!=null&&clearInterval(this.interval),this.interval=setInterval(()=>{this.time+=.01},10)},stopPlayStory(){clearInterval(this.interval),this.interval=null,this.run=!1},openViewersModal(t){this.$dialog.open(P,{data:{itemId:t},props:{header:this.$t("Viewers"),class:"likers-modal",modal:!0,dismissableMask:!0,draggable:!1},onClose:()=>{b(),this.doPlayStory()}}),this.stopPlayStory()},onKeyDown(t){switch(t.key){case"ArrowLeft":this.user.rtl?this.showNext&&this.nextStories():this.showPrev&&this.prevStories(),t.stopPropagation(),t.preventDefault();break;case"ArrowRight":this.user.rtl?this.showPrev&&this.prevStories():this.showNext&&this.nextStories(),t.stopPropagation(),t.preventDefault();break}}}},A={key:0,class:"h-full w-full select-none"},z={class:"h-full w-full relative"},j={class:"absolute top-4 left-2 right-2 lg:left-4 lg:right-4 flex gap-1 z-10"},K={key:0,class:"rounded-full h-1 w-full bg-white story-progress-bar"};function T(t,e,i,n,s,a){const v=y("StoryItemDetail"),m=y("BaseIcon"),g=y("Loading");return s.story?(o(),l("div",A,[w("div",z,[w("div",j,[(o(!0),l(L,null,M(s.story.items,r=>(o(),l("div",{key:r.id,class:"flex-1 bg-gray-400 rounded-full story-remaining-bar"},[s.storyItem.id>r.id?(o(),l("div",K)):h("",!0),s.storyItem.id==r.id?(o(),l("div",{key:1,class:"rounded-full h-1 w-full bg-progress story-progress-bar",style:C({width:s.time*100/t.config.storyTimeout+"%"})},null,4)):h("",!0)]))),128))]),u(v,{canMessage:s.story.canMessage,story:s.storyItem,owner:s.story.user,runningStory:s.run,isPage:i.isPage,onPlay_story:a.doPlayStory,onStop_story:a.stopPlayStory,onClose_story_modal:e[0]||(e[0]=r=>t.$emit("closeModal"))},null,8,["canMessage","story","owner","runningStory","isPage","onPlay_story","onStop_story"])]),s.showPrev?(o(),l("button",{key:0,onClick:e[1]||(e[1]=(...r)=>a.prevStories&&a.prevStories(...r)),class:"absolute top-1/2 -translate-y-1/2 ltr:left-2 ltr:lg:-left-20 rtl:right-2 rtl:lg:-right-20 z-10 flex items-center justify-center w-10 h-10 bg-white rounded-full shadow-md text-main-color dark:bg-dark-web-wash dark:text-white"},[u(m,{name:t.user.rtl?"caret_right":"caret_left"},null,8,["name"])])):h("",!0),s.showNext?(o(),l("button",{key:1,onClick:e[2]||(e[2]=(...r)=>a.nextStories&&a.nextStories(...r)),class:"absolute top-1/2 -translate-y-1/2 ltr:right-2 ltr:lg:-right-20 rtl:left-2 rtl:lg:-left-20 z-10 flex items-center justify-center w-10 h-10 bg-white rounded-full shadow-md text-main-color dark:bg-dark-web-wash dark:text-white"},[u(m,{name:t.user.rtl?"caret_left":"caret_right"},null,8,["name"])])):h("",!0)])):(o(),V(g,{key:1,class:"mx-auto"}))}const F=N(E,[["render",T]]);export{F as S};
