import{_ as U,aN as S,O as M,U as E,y as L,bg as R,r as p,o,c as n,g,w as f,d,t as u,e as a,b as w,F as c,bh as D,bi as N,B as T,A as q,h as z,J as O,m as C,l as j,u as H,C as J,aW as W,s as _,q as $,D as F,aX as X,a as h,E as G,x as K,v as Q,aU as P,aV as B}from"../../assets/app-73d10358.js";import{u as Y}from"./profile-8433b9ef.js";import Z from"./ProfileUserMenu-ea4ddec8.js";import{S as x}from"./StoryDetailModal-229f9f51.js";import"./StoryDetail-84b31e62.js";const ee={components:{Error:S,Loading:M,UsersList:E,BaseButton:L},inject:{dialogRef:{default:null}},data(){return{error:null,loadmore_status:!1,loading_users:!0,followingUsersList:[],page:1}},mounted(){this.getFollowingUsersList(this.user.id,this.page)},computed:{user(){return this.dialogRef.data.user}},methods:{async getFollowingUsersList(e,s){try{const r=await R(e,s);s===1?this.followingUsersList=r.items:this.followingUsersList=window._.concat(this.followingUsersList,r.items),r.has_next_page?(this.loadmore_status=!0,this.page++):this.loadmore_status=!1,this.loading_users=!1}catch(r){this.error=r,this.loading_users=!1}}}},se={key:3,class:"text-center"};function oe(e,s,r,y,i,t){const v=p("Error"),k=p("Loading"),b=p("UsersList"),m=p("BaseButton");return o(),n(c,null,[i.error?(o(),g(v,{key:0},{default:f(()=>[d(u(i.error),1)]),_:1})):a("",!0),i.loading_users?(o(),g(k,{key:1})):(o(),g(b,{key:2,usersList:i.followingUsersList},null,8,["usersList"])),i.loadmore_status?(o(),n("div",se,[w(m,{onClick:s[0]||(s[0]=I=>t.getFollowingUsersList(t.user.id,i.page))},{default:f(()=>[d(u(e.$t("View more")),1)]),_:1})])):a("",!0)],64)}const te=U(ee,[["render",oe]]),re={components:{Error:S,Loading:M,UsersList:E,BaseButton:L},inject:{dialogRef:{default:null}},data(){return{error:null,loadmore_status:!1,loading_users:!0,followerUsersList:[],page:1}},mounted(){this.getFollowerUsersList(this.user.id,this.page)},computed:{user(){return this.dialogRef.data.user}},methods:{async getFollowerUsersList(e,s){try{const r=await D(e,s);s===1?this.followerUsersList=r.items:this.followerUsersList=window._.concat(this.followerUsersList,r.items),r.has_next_page?(this.loadmore_status=!0,this.page++):this.loadmore_status=!1,this.loading_users=!1}catch(r){this.error=r,this.loading_users=!1}}}},ae={key:3,class:"text-center"};function le(e,s,r,y,i,t){const v=p("Error"),k=p("Loading"),b=p("UsersList"),m=p("BaseButton");return o(),n(c,null,[i.error?(o(),g(v,{key:0},{default:f(()=>[d(u(i.error),1)]),_:1})):a("",!0),i.loading_users?(o(),g(k,{key:1})):(o(),g(b,{key:2,usersList:i.followerUsersList},null,8,["usersList"])),i.loadmore_status?(o(),n("div",ae,[w(m,{onClick:s[0]||(s[0]=I=>t.getFollowerUsersList(t.user.id,i.page))},{default:f(()=>[d(u(e.$t("View more")),1)]),_:1})])):a("",!0)],64)}const ne=U(re,[["render",le]]),ie={components:{BaseButton:L,MessageButton:N,BaseIcon:T,Avatar:q,UserName:z},props:["data","params","position"],data(){return{mentionChar:O.MENTION}},computed:{...C(j,["config"]),...C(H,["user","authenticated"]),...C(Y,["userInfo"])},methods:{...J(W,["setSelectedPage"]),openProfileMenu(){this.$dialog.open(Z,{data:{userInfo:this.userInfo},props:{showHeader:!1,class:"dropdown-menu-modal",modal:!0,dismissableMask:!0,draggable:!1},onClose:()=>{_()}})},openFollowingModal(){this.$dialog.open(te,{data:{user:this.userInfo},props:{header:this.$t("Followings"),class:"follow-modal",modal:!0,dismissableMask:!0,draggable:!1}})},openFollowerModal(){this.$dialog.open(ne,{data:{user:this.userInfo},props:{header:this.$t("Followers"),class:"follow-modal",modal:!0,dismissableMask:!0,draggable:!1}})},showStoryDetail(e){if(e>0){let s=this.$router.resolve({name:"story_view",params:{storyId:e}});$(s.fullPath),this.$dialog.open(x,{data:{id:e,storiesList:[e]},props:{class:"p-dialog-story p-dialog-story-detail p-dialog-no-header-title",modal:!0,showHeader:!1,draggable:!1},onClose:()=>{$(this.$router.currentRoute.value.fullPath),_()}})}},uploadAvatar(e){var s=e.target;if(s.files&&s.files[0]){var r=new FileReader;r.onload=y=>{const i=P(()=>B(()=>import("./UploadAvatarModal-4950a5fd.js"),["./UploadAvatarModal-4950a5fd.js","../../assets/app-73d10358.js","../../assets/app-7630eb5f.css","./style-0c8b0731.js","../../assets/style-790ea523.css"],import.meta.url));this.$dialog.open(i,{data:{imageData:y.target.result},props:{header:this.$t("Crop Avatar"),class:"crop-avatar-modal p-dialog-md",modal:!0},onClose:t=>{t.data&&(this.userInfo.avatar=t.data.avatar),_()}})},r.readAsDataURL(s.files[0])}},uploadCover(e){var s=e.target;if(s.files&&s.files[0]){var r=new FileReader;r.onload=y=>{const i=P(()=>B(()=>import("./UploadCoverModal-5f0aeec3.js"),["./UploadCoverModal-5f0aeec3.js","../../assets/app-73d10358.js","../../assets/app-7630eb5f.css","./style-0c8b0731.js","../../assets/style-790ea523.css"],import.meta.url));this.$dialog.open(i,{data:{imageData:y.target.result},props:{header:this.$t("Crop Cover"),class:"crop-cover-modal p-dialog-lg",modal:!0},onClose:t=>{t.data&&(this.userInfo.cover=t.data.cover),_()}})},r.readAsDataURL(s.files[0])}},onInputClick(e){e.target.value=null},async followUser(e){if(this.authenticated)try{await F({id:e,action:"follow"}),this.userInfo.is_followed=!0,this.updateFollowStatus({userId:e,status:"follow"})}catch(s){this.showError(s.error)}else this.showRequireLogin()},async unFollowUser(e){try{await F({id:e,action:"unfollow"}),this.userInfo.is_followed=!1,this.updateFollowStatus({userId:e,status:"unfollow"})}catch(s){this.showError(s.error)}},async handleClickSwitchPage(e,s){this.setSelectedPage(e),setTimeout(async()=>{try{if(await X(e.id),s){let r=this.$router.resolve({name:"advertisings"});window.location.href=window.siteConfig.siteUrl+r.fullPath}else window.location.reload()}catch(r){this.showError(r.error),this.setSelectedPage(null)}},1500)},clickVerify(){let e="user_verify.send_request";this.checkPermission(e)&&this.$router.push({name:"verify_profile"})}}},ue={key:0,class:"header-profile bg-white rounded-none md:rounded-base-lg dark:bg-slate-800 mb-base-2"},de={class:"relative overflow-hidden rounded-none md:rounded-t-base-lg pb-[38.5%]"},fe={class:"absolute inset-0 h-full"},ge={class:"w-28 h-28 md:w-base-36 md:h-base-36"},pe={class:"px-4 pb-4"},me={class:"flex flex-wrap justify-between items-start gap-x-5 gap-y-1 mb-base-1"},he={class:"flex-1 max-w-full whitespace-nowrap"},we={class:"header-profile-username text-base-sm text-sub-color dark:text-slate-400 truncate"},ce={class:"flex flex-wrap items-center gap-2"},ve={key:0,class:"flex flex-wrap mb-1"},ye={key:1,class:"header-profile-count text-base-sm mb-base-1"},ke={key:1},be={key:2,class:"text-base-sm break-word"};function _e(e,s,r,y,i,t){const v=p("BaseIcon"),k=p("Avatar"),b=p("UserName"),m=p("BaseButton"),I=p("MessageButton"),A=p("router-link");return e.userInfo?(o(),n("div",ue,[h("div",de,[h("div",fe,[h("div",{class:"bg-cover bg-center bg-no-repeat w-full h-full",style:G({backgroundImage:`url(${e.userInfo.cover})`})},null,4)]),e.authenticated&&e.user.id==e.userInfo.id?(o(),n("button",{key:0,class:"inline-flex items-center gap-1 bg-gray-trans-4 text-white rounded p-1 absolute top-base-2 end-base-2",onClick:s[2]||(s[2]=l=>e.$refs.cover.click())},[w(v,{name:"camera"}),h("input",{type:"file",ref:"cover",onChange:s[0]||(s[0]=l=>t.uploadCover(l)),onClick:s[1]||(s[1]=l=>t.onInputClick(l)),accept:"image/*",class:"hidden"},null,544)])):a("",!0)]),h("div",{class:K(["relative inline-block p-base-1 ms-4 -mt-20 md:-mt-28 rounded-full",e.userInfo.story_id==0?"bg-white dark:bg-slate-800":"bg-gradient-story cursor-pointer"])},[h("div",ge,[w(k,{user:e.userInfo,size:"100%",activePopover:!1,border:!1,onClick:s[3]||(s[3]=l=>e.userInfo.story_id==0?"":t.showStoryDetail(e.userInfo.story_id))},null,8,["user"])]),e.authenticated&&e.user.id==e.userInfo.id?(o(),n("button",{key:0,class:"inline-flex items-center gap-1 bg-gray-trans-4 text-white rounded-full p-1 absolute top-0 end-1 md:top-2 md:end-2",onClick:s[6]||(s[6]=l=>e.$refs.avatar.click())},[w(v,{name:"camera"}),h("input",{type:"file",ref:"avatar",onChange:s[4]||(s[4]=l=>t.uploadAvatar(l)),onClick:s[5]||(s[5]=l=>t.onInputClick(l)),accept:"image/*",class:"hidden"},null,544)])):a("",!0)],2),h("div",pe,[h("div",me,[h("div",he,[w(b,{user:e.userInfo,activePopover:!1,class:"header-profile-name text-base-lg font-extrabold"},null,8,["user"]),h("div",we,u(i.mentionChar+e.userInfo.user_name),1)]),h("div",ce,[e.userInfo.is_page?(o(),n(c,{key:0},[e.userInfo.id===e.user.id?(o(),n(c,{key:0},[e.config.advertising.enable?(o(),g(m,{key:0,type:"outlined",to:{name:"advertisings"}},{default:f(()=>[d(u(e.$t("Advertise")),1)]),_:1})):a("",!0),e.config.user_page.featureEnable&&!e.userInfo.is_page_feature?(o(),g(m,{key:1,type:"outlined",to:{name:"user_pages_feature"}},{default:f(()=>[d(u(e.$t("Feature Page")),1)]),_:1})):a("",!0),w(m,{type:"outlined",to:{name:"user_pages_overview"}},{default:f(()=>[d(u(e.$t("Manage")),1)]),_:1})],64)):a("",!0),e.userInfo.is_page_admin&&e.config.advertising.enable?(o(),g(m,{key:1,type:"outlined",onClick:s[7]||(s[7]=l=>t.handleClickSwitchPage(e.userInfo,!0))},{default:f(()=>[d(u(e.$t("Advertise")),1)]),_:1})):a("",!0),e.userInfo.is_page_admin?(o(),g(m,{key:2,type:"outlined",onClick:s[8]||(s[8]=l=>t.handleClickSwitchPage(e.userInfo,!1))},{default:f(()=>[d(u(e.$t("Switch Page")),1)]),_:1})):a("",!0)],64)):a("",!0),e.user.id!==e.userInfo.id?(o(),n(c,{key:1},[e.userInfo.can_send_message||e.userInfo.chat_room_id?(o(),g(I,{key:0,user_id:e.userInfo.id},null,8,["user_id"])):a("",!0),e.userInfo.can_follow?(o(),n(c,{key:1},[e.userInfo.is_followed?(o(),g(m,{key:0,onClick:s[9]||(s[9]=l=>t.unFollowUser(e.userInfo.id)),type:"outlined"},{default:f(()=>[d(u(e.$t("Unfollow")),1)]),_:1})):(o(),g(m,{key:1,onClick:s[10]||(s[10]=l=>t.followUser(e.userInfo.id)),type:"outlined"},{default:f(()=>[d(u(e.$t("Follow")),1)]),_:1}))],64)):a("",!0),e.authenticated?(o(),n("button",{key:2,onClick:s[11]||(s[11]=l=>t.openProfileMenu())},[w(v,{name:"more_horiz_outlined"})])):a("",!0)],64)):(o(),n(c,{key:2},[!e.userInfo.is_verify&&e.config.userVerifyEnable?(o(),g(m,{key:0,type:"outlined",onClick:t.clickVerify},{default:f(()=>[d(u(e.userInfo.is_page?e.$t("Verify Page"):e.$t("Verify Profile")),1)]),_:1},8,["onClick"])):a("",!0),w(m,{type:"outlined",to:{name:"setting_index"}},{default:f(()=>[d(u(e.userInfo.is_page?e.$t("Edit Page"):e.$t("Edit Profile")),1)]),_:1})],64))])]),e.userInfo.categories&&e.userInfo.categories.length?(o(),n("div",ve,[(o(!0),n(c,null,Q(e.userInfo.categories,(l,V)=>(o(),n("span",{key:l.id},[w(A,{to:{name:"user_pages",query:{category_id:l.id}}},{default:f(()=>[d(u(l.name),1)]),_:2},1032,["to"]),d(" "+u(V===e.userInfo.categories.length-1?"":". "),1)]))),128))])):a("",!0),e.userInfo.check_private?a("",!0):(o(),n("div",ye,[e.userInfo.show_following?(o(),n("button",{key:0,onClick:s[12]||(s[12]=l=>t.openFollowingModal())},u(e.$filters.numberShortener(e.userInfo.following_count,e.$t("[number] Following"),e.$t("[number] Followings"))),1)):a("",!0),s[14]||(s[14]=d()),e.userInfo.show_following&&e.userInfo.show_follower?(o(),n("span",ke,".")):a("",!0),s[15]||(s[15]=d()),e.userInfo.show_follower?(o(),n("button",{key:2,onClick:s[13]||(s[13]=l=>t.openFollowerModal())},u(e.$filters.numberShortener(e.userInfo.follower_count,e.$t("[number] Follower"),e.$t("[number] Followers"))),1)):a("",!0)])),e.userInfo.check_privacy?(o(),n("div",be,u(e.userInfo.bio),1)):a("",!0)])])):a("",!0)}const Fe=U(ie,[["render",_e]]);export{Fe as default};
